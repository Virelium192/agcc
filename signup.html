<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Agriclimate Connect - Complete Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'green-earth': '#2D7D32',
                        'brown-soil': '#8D6E63',
                        'blue-sky': '#1976D2',
                        'yellow-sun': '#FBC02D',
                        'gold': '#FFD700',
                        'emerald': '#10B981',
                        'sapphire': '#3B82F6'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    },
                    animation: {
                        'gradient': 'gradient 15s ease infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slide-up 0.5s ease-out',
                        'fade-in': 'fade-in 0.6s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        .premium-gradient {
            background: linear-gradient(135deg, #2D7D32 0%, #1976D2 25%, #5D5CDE 50%, #FBC02D 75%, #10B981 100%);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes slide-up {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .premium-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(45, 125, 50, 0.1);
            box-shadow: 0 16px 64px rgba(0, 0, 0, 0.05), 0 8px 32px rgba(45, 125, 50, 0.1);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .dark .premium-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.6) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .step-indicator {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .step-indicator.active {
            background: linear-gradient(135deg, #2D7D32, #10B981);
            color: white;
            box-shadow: 0 8px 25px rgba(45, 125, 50, 0.4);
            transform: scale(1.1);
        }
        
        .step-indicator.completed {
            background: linear-gradient(135deg, #FBC02D, #FFD700);
            color: #2D7D32;
            box-shadow: 0 8px 25px rgba(251, 192, 45, 0.4);
        }
        
        .form-input {
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(45, 125, 50, 0.1);
        }
        
        .dark .form-input {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(45, 125, 50, 0.15);
            border-color: #2D7D32;
            background: rgba(255, 255, 255, 1);
        }
        
        .premium-button {
            background: linear-gradient(135deg, #2D7D32, #10B981);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }
        
        .premium-button:hover {
            background: linear-gradient(135deg, #1976D2, #3B82F6);
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(45, 125, 50, 0.4);
        }
        
        .checkbox-premium, .radio-premium {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #2D7D32;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .checkbox-premium {
            border-radius: 4px;
        }
        
        .radio-premium {
            border-radius: 50%;
        }
        
        .checkbox-premium:checked {
            background: linear-gradient(135deg, #2D7D32, #10B981);
        }
        
        .checkbox-premium:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .radio-premium:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2D7D32, #10B981);
        }
        
        .required::after {
            content: ' *';
            color: #ef4444;
            font-weight: bold;
        }
        
        .password-strength {
            height: 6px;
            border-radius: 3px;
            transition: all 0.3s ease;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981, #059669);
            background-size: 400% 100%;
        }
        
        .strength-weak { background-position: 0% 50%; width: 25%; }
        .strength-fair { background-position: 33% 50%; width: 50%; }
        .strength-good { background-position: 66% 50%; width: 75%; }
        .strength-strong { background-position: 100% 50%; width: 100%; }
    </style>
</head>
<body class="min-h-screen premium-gradient font-inter relative overflow-x-hidden">
    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass-morphism">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-earth to-emerald rounded-full flex items-center justify-center shadow-lg">
                        <i class="fas fa-seedling text-white text-xl"></i>
                    </div>
                    <div>
                        <div class="font-bold text-xl text-white">Agriclimate Connect</div>
                        <div class="text-xs text-white/80">Empowering Farmers, Sustaining the Future</div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleDarkMode()" class="p-3 hover:bg-white/10 rounded-full transition-colors">
                        <i class="fas fa-moon text-white dark:hidden"></i>
                        <i class="fas fa-sun text-white hidden dark:block"></i>
                    </button>
                    <a href="/" class="text-white/90 hover:text-white text-sm font-medium transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Home
                    </a>
                    <a href="login.html" class="text-white/90 hover:text-white text-sm font-medium transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Login
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-16 relative">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Hero Section -->
            <div class="text-center mb-16 animate-fade-in">
                <div class="w-32 h-32 mx-auto mb-8 bg-gradient-to-br from-gold to-yellow-sun rounded-full flex items-center justify-center shadow-2xl animate-float">
                    <i class="fas fa-user-plus text-white text-5xl"></i>
                </div>
                <h1 class="text-5xl lg:text-7xl font-bold mb-6 text-white drop-shadow-2xl">
                    Join the Future of
                    <span class="bg-gradient-to-r from-gold to-yellow-sun bg-clip-text text-transparent">Agriculture</span>
                </h1>
                <p class="text-xl text-white/90 max-w-3xl mx-auto leading-relaxed">
                    Complete your comprehensive agricultural profile to unlock personalized AI-powered insights, climate-smart recommendations, and connect with the global farming community.
                </p>
            </div>

            <!-- Progress Indicator -->
            <div class="mb-16">
                <div class="flex justify-center items-center space-x-4 mb-8">
                    <div id="step-indicator-1" class="step-indicator w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold transition-all cursor-pointer">1</div>
                    <div class="w-20 h-2 bg-white/20 rounded-full overflow-hidden">
                        <div id="progress-bar-1" class="h-full bg-gradient-to-r from-green-earth to-emerald transition-all duration-700" style="width: 0%"></div>
                    </div>
                    <div id="step-indicator-2" class="step-indicator w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold transition-all cursor-pointer">2</div>
                    <div class="w-20 h-2 bg-white/20 rounded-full overflow-hidden">
                        <div id="progress-bar-2" class="h-full bg-gradient-to-r from-green-earth to-emerald transition-all duration-700" style="width: 0%"></div>
                    </div>
                    <div id="step-indicator-3" class="step-indicator w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold transition-all cursor-pointer">3</div>
                    <div class="w-20 h-2 bg-white/20 rounded-full overflow-hidden">
                        <div id="progress-bar-3" class="h-full bg-gradient-to-r from-green-earth to-emerald transition-all duration-700" style="width: 0%"></div>
                    </div>
                    <div id="step-indicator-4" class="step-indicator w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold transition-all cursor-pointer">4</div>
                    <div class="w-20 h-2 bg-white/20 rounded-full overflow-hidden">
                        <div id="progress-bar-4" class="h-full bg-gradient-to-r from-green-earth to-emerald transition-all duration-700" style="width: 0%"></div>
                    </div>
                    <div id="step-indicator-5" class="step-indicator w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold transition-all cursor-pointer">5</div>
                </div>
                <div class="text-center">
                    <span id="current-step-text" class="text-lg font-semibold text-white/90 bg-black/20 px-6 py-2 rounded-full backdrop-blur-sm">Step 1 of 5: Account & Identity</span>
                </div>
            </div>

            <!-- Registration Form -->
            <form id="registration-form" class="space-y-8" novalidate>
                <!-- Step 1: Account Basics & Location -->
                <div id="step-1" class="step-content animate-slide-up">
                    <!-- A. Account Basics -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-earth to-emerald rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-user text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Account Basics</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your core identity and contact information</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Full Name</label>
                                <input type="text" id="full_name" name="full_name" required 
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg font-medium"
                                       placeholder="Enter your complete legal name">
                                <p class="text-xs text-gray-500">Used for personalization, support, and legal documents</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Preferred Display Name / Farm Name</label>
                                <input type="text" id="display_name" name="display_name"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg font-medium"
                                       placeholder="How you'd like to be known in the community">
                                <p class="text-xs text-gray-500">For community posts and marketplace listings</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Email Address</label>
                                <input type="email" id="email" name="email" required
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg font-medium"
                                       placeholder="your.email@example.com" onblur="validateEmail()">
                                <div id="email-validation" class="text-sm"></div>
                                <p class="text-xs text-gray-500">For login, alerts, and account verification</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Mobile Phone Number</label>
                                <div class="flex">
                                    <select id="country_code" name="country_code" class="form-input px-4 py-4 rounded-l-xl border-r-0 text-lg">
                                        <option value="+1">🇺🇸 +1</option>
                                        <option value="+44">🇬🇧 +44</option>
                                        <option value="+254">🇰🇪 +254</option>
                                        <option value="+234">🇳🇬 +234</option>
                                        <option value="+27">🇿🇦 +27</option>
                                        <option value="+91">🇮🇳 +91</option>
                                        <option value="+55">🇧🇷 +55</option>
                                    </select>
                                    <input type="tel" id="phone_number" name="phone_number"
                                           class="form-input flex-1 px-6 py-4 rounded-r-xl text-lg font-medium border-l-0"
                                           placeholder="123 456 7890">
                                </div>
                                <p class="text-xs text-gray-500">Recommended for 2FA and urgent weather alerts</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Password</label>
                                <div class="relative">
                                    <input type="password" id="password" name="password" required
                                           class="form-input w-full px-6 py-4 pr-14 rounded-xl text-lg font-medium"
                                           placeholder="Create a secure password" onkeyup="checkPasswordStrength()">
                                    <button type="button" onclick="togglePasswordVisibility('password')" 
                                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 text-xl">
                                        <i class="fas fa-eye" id="password-eye"></i>
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <div class="password-strength" id="password-strength"></div>
                                    <div id="password-text" class="text-sm mt-2 font-medium"></div>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Confirm Password</label>
                                <div class="relative">
                                    <input type="password" id="confirm_password" name="confirm_password" required
                                           class="form-input w-full px-6 py-4 pr-14 rounded-xl text-lg font-medium"
                                           placeholder="Confirm your password" onkeyup="checkPasswordMatch()">
                                    <button type="button" onclick="togglePasswordVisibility('confirm_password')" 
                                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 text-xl">
                                        <i class="fas fa-eye" id="confirm_password-eye"></i>
                                    </button>
                                </div>
                                <div id="password-match" class="text-sm mt-2"></div>
                            </div>
                        </div>
                        
                        <div class="mt-10">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Profile Photo</label>
                            <div class="flex items-center space-x-6">
                                <div id="profile-preview" class="w-32 h-32 bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded-full flex items-center justify-center shadow-lg">
                                    <i class="fas fa-user text-gray-400 text-4xl"></i>
                                </div>
                                <div class="flex-1">
                                    <input type="file" id="profile_photo" name="profile_photo" accept="image/*" class="hidden" onchange="previewProfilePhoto()">
                                    <button type="button" onclick="document.getElementById('profile_photo').click()" 
                                            class="premium-button text-white px-8 py-4 rounded-xl font-semibold text-lg mb-3">
                                        <i class="fas fa-upload mr-3"></i>Upload Photo
                                    </button>
                                    <p class="text-sm text-gray-500">Optional - helps build community trust</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- B. Location & Geodata -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-blue-sky to-sapphire rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-map-marker-alt text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Location & Farm Details</h2>
                                <p class="text-gray-600 dark:text-gray-300">Critical for weather forecasts and recommendations</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Country</label>
                                <select id="country" name="country" required class="form-input w-full px-6 py-4 rounded-xl text-lg" onchange="loadStates()">
                                    <option value="">Select your country</option>
                                    <option value="US">🇺🇸 United States</option>
                                    <option value="CA">🇨🇦 Canada</option>
                                    <option value="KE">🇰🇪 Kenya</option>
                                    <option value="NG">🇳🇬 Nigeria</option>
                                    <option value="ZA">🇿🇦 South Africa</option>
                                    <option value="IN">🇮🇳 India</option>
                                    <option value="BR">🇧🇷 Brazil</option>
                                    <option value="AU">🇦🇺 Australia</option>
                                    <option value="GB">🇬🇧 United Kingdom</option>
                                    <option value="DE">🇩🇪 Germany</option>
                                    <option value="FR">🇫🇷 France</option>
                                    <option value="MX">🇲🇽 Mexico</option>
                                    <option value="AR">🇦🇷 Argentina</option>
                                    <option value="EG">🇪🇬 Egypt</option>
                                    <option value="TH">🇹🇭 Thailand</option>
                                </select>
                                <p class="text-xs text-gray-500">Regional settings, currency, and regulations</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">State / Province / Region</label>
                                <select id="state" name="state" required class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select country first</option>
                                </select>
                                <p class="text-xs text-gray-500">Regional weather and climate models</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">County / District</label>
                                <input type="text" id="county" name="county"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg font-medium"
                                       placeholder="Local administrative area">
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Nearest Town / City</label>
                                <input type="text" id="nearest_city" name="nearest_city"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg font-medium"
                                       placeholder="Closest urban center">
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Exact Farm Coordinates</label>
                            <div class="grid md:grid-cols-4 gap-4 items-end">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-2">Latitude</label>
                                    <input type="number" id="latitude" name="latitude" step="any"
                                           class="form-input w-full px-4 py-3 rounded-xl text-lg"
                                           placeholder="0.000000">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-2">Longitude</label>
                                    <input type="number" id="longitude" name="longitude" step="any"
                                           class="form-input w-full px-4 py-3 rounded-xl text-lg"
                                           placeholder="0.000000">
                                </div>
                                <button type="button" onclick="getCurrentLocation()" 
                                        class="premium-button text-white px-6 py-3 rounded-xl font-semibold col-span-2">
                                    <i class="fas fa-crosshairs mr-2"></i>Use My Location
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Precise weather & soil zone mapping</p>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Farm Address / Postal Address</label>
                            <textarea id="farm_address" name="farm_address" rows="3"
                                      class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                      placeholder="Complete postal address (optional)"></textarea>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 required">Farm Area / Size</label>
                                <div class="flex">
                                    <input type="number" id="farm_size" name="farm_size" required min="0" step="0.01"
                                           class="form-input flex-1 px-6 py-4 rounded-l-xl text-lg border-r-0"
                                           placeholder="0.00">
                                    <select id="farm_size_unit" name="farm_size_unit" class="form-input px-4 py-4 rounded-r-xl text-lg">
                                        <option value="hectares">Hectares</option>
                                        <option value="acres">Acres</option>
                                    </select>
                                </div>
                                <p class="text-xs text-gray-500">Scale recommendations, market sizing</p>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">Farm Elevation</label>
                                <div class="flex">
                                    <input type="number" id="elevation" name="elevation" min="0"
                                           class="form-input flex-1 px-6 py-4 rounded-l-xl text-lg border-r-0"
                                           placeholder="0">
                                    <select id="elevation_unit" name="elevation_unit" class="form-input px-4 py-4 rounded-r-xl text-lg">
                                        <option value="meters">Meters</option>
                                        <option value="feet">Feet</option>
                                    </select>
                                </div>
                                <p class="text-xs text-gray-500">Can be derived from coordinates</p>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Nearest Water Sources</label>
                            <div class="grid md:grid-cols-3 gap-6">
                                <div>
                                    <select id="water_source_type" name="water_source_type" class="form-input w-full px-4 py-3 rounded-xl text-lg">
                                        <option value="">Select water source</option>
                                        <option value="river">🏞️ River</option>
                                        <option value="lake">🏔️ Lake</option>
                                        <option value="borehole">🕳️ Borehole</option>
                                        <option value="dam">🚧 Dam</option>
                                        <option value="well">⚪ Well</option>
                                        <option value="spring">💧 Natural Spring</option>
                                        <option value="canal">🚰 Irrigation Canal</option>
                                        <option value="none">❌ No nearby source</option>
                                    </select>
                                </div>
                                <div>
                                    <input type="number" id="water_source_distance" name="water_source_distance" min="0"
                                           class="form-input w-full px-4 py-3 rounded-xl text-lg"
                                           placeholder="Distance">
                                </div>
                                <div>
                                    <select id="distance_unit" name="distance_unit" class="form-input w-full px-4 py-3 rounded-xl text-lg">
                                        <option value="km">Kilometers</option>
                                        <option value="miles">Miles</option>
                                        <option value="meters">Meters</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Farm Type & Production -->
                <div id="step-2" class="step-content hidden animate-slide-up">
                    <!-- C. Farm Type & Production Focus -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-earth to-emerald rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-tractor text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Farm Type & Production</h2>
                                <p class="text-gray-600 dark:text-gray-300">Define your agricultural focus and methods</p>
                            </div>
                        </div>
                        
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Farm Type (Select all that apply)</label>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="crop_farming" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🌾</span>Crop Farming</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="livestock" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐄</span>Livestock</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="mixed" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🚜</span>Mixed Farming</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="horticulture" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🍎</span>Horticulture</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="aquaculture" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐟</span>Aquaculture</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="agroforestry" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🌳</span>Agroforestry</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="greenhouse" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🏠</span>Greenhouse</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="urban_farming" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🏙️</span>Urban Farming</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="beekeeping" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐝</span>Beekeeping</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="poultry" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐔</span>Poultry</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="farm_type" value="dairy" class="checkbox-premium">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🥛</span>Dairy</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Primary Crops Grown</label>
                                    <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-48 overflow-y-auto">
                                        <div class="grid grid-cols-1 gap-2">
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="maize" class="checkbox-premium"><span>🌽 Maize/Corn</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="wheat" class="checkbox-premium"><span>🌾 Wheat</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="rice" class="checkbox-premium"><span>🍚 Rice</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="beans" class="checkbox-premium"><span>🫘 Beans</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="soybeans" class="checkbox-premium"><span>🫛 Soybeans</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="cotton" class="checkbox-premium"><span>🌿 Cotton</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="sugarcane" class="checkbox-premium"><span>🎋 Sugarcane</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="coffee" class="checkbox-premium"><span>☕ Coffee</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="tea" class="checkbox-premium"><span>🍵 Tea</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="tomatoes" class="checkbox-premium"><span>🍅 Tomatoes</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="potatoes" class="checkbox-premium"><span>🥔 Potatoes</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="onions" class="checkbox-premium"><span>🧅 Onions</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="carrots" class="checkbox-premium"><span>🥕 Carrots</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="cabbage" class="checkbox-premium"><span>🥬 Cabbage</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="bananas" class="checkbox-premium"><span>🍌 Bananas</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="primary_crops" value="avocados" class="checkbox-premium"><span>🥑 Avocados</span></label>
                                        </div>
                                    </div>
                                    <input type="text" id="other_primary_crops" name="other_primary_crops" placeholder="Other crops (comma separated)" 
                                           class="form-input w-full px-4 py-3 rounded-xl text-lg mt-3">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Secondary Crops Grown</label>
                                    <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-48 overflow-y-auto">
                                        <div class="grid grid-cols-1 gap-2">
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="sorghum" class="checkbox-premium"><span>🌾 Sorghum</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="millet" class="checkbox-premium"><span>🌾 Millet</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="cassava" class="checkbox-premium"><span>🍠 Cassava</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="sweet_potatoes" class="checkbox-premium"><span>🍠 Sweet Potatoes</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="yams" class="checkbox-premium"><span>🍠 Yams</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="groundnuts" class="checkbox-premium"><span>🥜 Groundnuts</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="sunflower" class="checkbox-premium"><span>🌻 Sunflower</span></label>
                                            <label class="flex items-center space-x-2"><input type="checkbox" name="secondary_crops" value="sesame" class="checkbox-premium"><span>🌱 Sesame</span></label>
                                        </div>
                                    </div>
                                    <input type="text" id="other_secondary_crops" name="other_secondary_crops" placeholder="Other secondary crops" 
                                           class="form-input w-full px-4 py-3 rounded-xl text-lg mt-3">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Primary Livestock Types</label>
                                <div class="grid md:grid-cols-4 gap-4">
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="cattle" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐄</span>Cattle</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="goats" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐐</span>Goats</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="sheep" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐑</span>Sheep</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="pigs" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐷</span>Pigs</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="chickens" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐔</span>Chickens</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="ducks" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🦆</span>Ducks</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="turkeys" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🦃</span>Turkeys</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-green-earth cursor-pointer transition-colors">
                                        <input type="checkbox" name="livestock_types" value="rabbits" class="checkbox-premium" onchange="toggleLivestockNumbers()">
                                        <span class="flex items-center"><span class="text-2xl mr-2">🐰</span>Rabbits</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="livestock-numbers" class="hidden">
                                <h3 class="text-lg font-semibold mb-4">Number of Livestock (by type)</h3>
                                <div class="grid md:grid-cols-2 gap-4" id="livestock-count-inputs">
                                    <!-- Dynamic livestock number inputs will be added here -->
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Greenhouse / Controlled Environment?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="has_greenhouse" value="no" class="radio-premium">
                                            <span>No greenhouse facilities</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="has_greenhouse" value="yes" class="radio-premium" onchange="toggleGreenhouseSize()">
                                            <span>Yes, have greenhouse/controlled environment</span>
                                        </label>
                                    </div>
                                    <div id="greenhouse-size" class="hidden mt-4">
                                        <label class="block text-sm font-medium mb-2">Greenhouse Size</label>
                                        <div class="flex">
                                            <input type="number" id="greenhouse_size_value" name="greenhouse_size_value" min="0"
                                                   class="form-input flex-1 px-4 py-3 rounded-l-xl text-lg border-r-0"
                                                   placeholder="Size">
                                            <select id="greenhouse_size_unit" name="greenhouse_size_unit" class="form-input px-4 py-3 rounded-r-xl text-lg">
                                                <option value="sq_meters">Sq. Meters</option>
                                                <option value="sq_feet">Sq. Feet</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Is the farm commercial or subsistence?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="farm_scale" value="subsistence" required class="radio-premium">
                                            <span>Subsistence (for family consumption)</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="farm_scale" value="small_commercial" required class="radio-premium">
                                            <span>Small commercial (local sales)</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="farm_scale" value="commercial" required class="radio-premium">
                                            <span>Commercial (regional/national markets)</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="farm_scale" value="industrial" required class="radio-premium">
                                            <span>Industrial scale (export/large scale)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Annual Production Volume (approx.)</label>
                                    <div class="flex">
                                        <input type="number" id="production_volume" name="production_volume" min="0"
                                               class="form-input flex-1 px-4 py-3 rounded-l-xl text-lg border-r-0"
                                               placeholder="Volume">
                                        <select id="production_unit" name="production_unit" class="form-input px-4 py-3 rounded-r-xl text-lg">
                                            <option value="tons">Tons</option>
                                            <option value="kg">Kilograms</option>
                                            <option value="bags">Bags</option>
                                            <option value="liters">Liters</option>
                                            <option value="pieces">Pieces</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you process or add value to produce?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="value_addition" value="no" class="radio-premium">
                                            <span>No processing</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="value_addition" value="yes" class="radio-premium" onchange="toggleProcessingDetails()">
                                            <span>Yes, we process/add value</span>
                                        </label>
                                    </div>
                                    <div id="processing-details" class="hidden mt-4">
                                        <input type="text" id="processing_type" name="processing_type" placeholder="Type of processing (milling, drying, packaging, etc.)" 
                                               class="form-input w-full px-4 py-3 rounded-xl text-lg">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- D. Soil & Land Management -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-brown-soil to-yellow-sun rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-seedling text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Soil & Land Management</h2>
                                <p class="text-gray-600 dark:text-gray-300">Understanding your soil for better recommendations</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Soil Type</label>
                                <select id="soil_type" name="soil_type" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select soil type</option>
                                    <option value="sandy">🏖️ Sandy</option>
                                    <option value="loamy">🌱 Loamy</option>
                                    <option value="clay">🏺 Clay</option>
                                    <option value="silt">🌊 Silt</option>
                                    <option value="peat">🌿 Peat</option>
                                    <option value="chalk">⚪ Chalk</option>
                                    <option value="mixed">🔄 Mixed</option>
                                    <option value="unknown">❓ Unknown</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Have you conducted a soil test in the last 3 years?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="soil_test_recent" value="yes" class="radio-premium" onchange="toggleSoilTestUpload()">
                                        <span>Yes, within last 3 years</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="soil_test_recent" value="old" class="radio-premium">
                                        <span>Yes, but over 3 years ago</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="soil_test_recent" value="no" class="radio-premium">
                                        <span>No soil test conducted</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="soil-test-upload" class="hidden mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Upload Soil Test Results</label>
                            <input type="file" id="soil_test_file" name="soil_test_file" accept=".pdf,.jpg,.jpeg,.png" 
                                   class="form-input w-full px-6 py-4 rounded-xl text-lg">
                            <p class="text-xs text-gray-500 mt-2">Upload PDF or image of soil test results</p>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 required">Irrigation Availability</label>
                                <select id="irrigation_type" name="irrigation_type" required class="form-input w-full px-6 py-4 rounded-xl text-lg" onchange="toggleIrrigationSource()">
                                    <option value="">Select irrigation type</option>
                                    <option value="none">None / Rain-fed only</option>
                                    <option value="drip">💧 Drip irrigation</option>
                                    <option value="sprinkler">🚿 Sprinkler system</option>
                                    <option value="flood">🌊 Flood irrigation</option>
                                    <option value="manual">🪣 Manual watering</option>
                                    <option value="other">🔧 Other system</option>
                                </select>
                            </div>
                            
                            <div id="irrigation-source-div" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Irrigation Water Source</label>
                                <select id="irrigation_source" name="irrigation_source" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select water source</option>
                                    <option value="borehole">🕳️ Borehole</option>
                                    <option value="river">🏞️ River</option>
                                    <option value="lake">🏔️ Lake</option>
                                    <option value="dam">🚧 Dam/Reservoir</option>
                                    <option value="well">⚪ Well</option>
                                    <option value="municipal">🏢 Municipal supply</option>
                                    <option value="rainwater">☔ Rainwater harvesting</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Soil pH (if known)</label>
                                <input type="number" id="soil_ph" name="soil_ph" min="0" max="14" step="0.1"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="0.0 - 14.0">
                                <p class="text-xs text-gray-500 mt-1">pH scale from 0 (acidic) to 14 (alkaline)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Soil Organic Matter % (if known)</label>
                                <input type="number" id="organic_matter" name="organic_matter" min="0" max="100" step="0.1"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="0.0 - 100.0">
                                <p class="text-xs text-gray-500 mt-1">Percentage of organic matter in soil</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Climate, Crops & Livestock -->
                <div id="step-3" class="step-content hidden animate-slide-up">
                    <!-- E. Climate & Weather Preferences -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-blue-sky to-sapphire rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-cloud-sun text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Climate & Weather Preferences</h2>
                                <p class="text-gray-600 dark:text-gray-300">Configure your weather monitoring and alerts</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Preferred Units (Temperature)</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="temperature_units" value="celsius" required class="radio-premium">
                                        <span>🌡️ Celsius (°C)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="temperature_units" value="fahrenheit" required class="radio-premium">
                                        <span>🌡️ Fahrenheit (°F)</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Preferred Units (Rainfall)</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="rainfall_units" value="mm" required class="radio-premium">
                                        <span>📏 Millimeters (mm)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="rainfall_units" value="inches" required class="radio-premium">
                                        <span>📏 Inches (in)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Do you want real-time weather alerts?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="weather_alerts" value="yes" required class="radio-premium" onchange="toggleAlertChannels()">
                                    <span>✅ Yes, I want weather alerts (recommended)</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="weather_alerts" value="no" required class="radio-premium" onchange="toggleAlertChannels()">
                                    <span>❌ No weather alerts</span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="alert-channels" class="hidden mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Preferred Alert Channels</label>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-sky cursor-pointer">
                                    <input type="checkbox" name="alert_channels" value="sms" class="checkbox-premium">
                                    <span>📱 SMS</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-sky cursor-pointer">
                                    <input type="checkbox" name="alert_channels" value="email" class="checkbox-premium">
                                    <span>📧 Email</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-sky cursor-pointer">
                                    <input type="checkbox" name="alert_channels" value="push" class="checkbox-premium">
                                    <span>🔔 App Push</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-sky cursor-pointer">
                                    <input type="checkbox" name="alert_channels" value="whatsapp" class="checkbox-premium">
                                    <span>💬 WhatsApp</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-blue-sky cursor-pointer">
                                    <input type="checkbox" name="alert_channels" value="voice" class="checkbox-premium">
                                    <span>📞 Voice Call</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Alert Severity Preference</label>
                                <select id="alert_frequency" name="alert_frequency" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="low">🔕 Low (only severe alerts)</option>
                                    <option value="medium" selected>🔔 Medium (important alerts)</option>
                                    <option value="high">🔊 High (all alerts)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want seasonal climate risk forecasts?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="seasonal_forecasts" value="yes" class="radio-premium">
                                        <span>Yes, include seasonal forecasts</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="seasonal_forecasts" value="no" class="radio-premium">
                                        <span>No seasonal forecasts needed</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- F. Crop & Planting Preferences -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-earth to-emerald rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-wheat text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Crop & Planting Preferences</h2>
                                <p class="text-gray-600 dark:text-gray-300">Used for personalized crop recommendations</p>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Which crops would you like recommendations for?</label>
                            <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-64 overflow-y-auto">
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="maize" class="checkbox-premium"><span>🌽 Maize/Corn</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="wheat" class="checkbox-premium"><span>🌾 Wheat</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="rice" class="checkbox-premium"><span>🍚 Rice</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="beans" class="checkbox-premium"><span>🫘 Beans</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="soybeans" class="checkbox-premium"><span>🫛 Soybeans</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="tomatoes" class="checkbox-premium"><span>🍅 Tomatoes</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="potatoes" class="checkbox-premium"><span>🥔 Potatoes</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="onions" class="checkbox-premium"><span>🧅 Onions</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="carrots" class="checkbox-premium"><span>🥕 Carrots</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="cabbage" class="checkbox-premium"><span>🥬 Cabbage</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="lettuce" class="checkbox-premium"><span>🥬 Lettuce</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="recommendation_crops" value="spinach" class="checkbox-premium"><span>🥬 Spinach</span></label>
                                </div>
                            </div>
                            <input type="text" id="custom_recommendation_crops" name="custom_recommendation_crops" placeholder="Other crops for recommendations" 
                                   class="form-input w-full px-6 py-4 rounded-xl text-lg mt-4">
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Preferred Planting Window (months)</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Start Month</label>
                                        <select id="planting_start_month" name="planting_start_month" class="form-input w-full px-4 py-3 rounded-xl text-lg">
                                            <option value="">Select month</option>
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">End Month</label>
                                        <select id="planting_end_month" name="planting_end_month" class="form-input w-full px-4 py-3 rounded-xl text-lg">
                                            <option value="">Select month</option>
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Seed Source</label>
                                <select id="seed_source" name="seed_source" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select seed source</option>
                                    <option value="own">💾 Save own seeds</option>
                                    <option value="bought">🛒 Purchase seeds</option>
                                    <option value="cooperative">🤝 Cooperative/group buying</option>
                                    <option value="government">🏛️ Government programs</option>
                                    <option value="mixed">🔄 Mixed sources</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you open to introducing new varieties?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="new_varieties" value="yes" class="radio-premium">
                                        <span>✅ Yes, open to new varieties</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="new_varieties" value="no" class="radio-premium">
                                        <span>❌ No, prefer current varieties</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="new_varieties" value="maybe" class="radio-premium">
                                        <span>🤔 Maybe, with good evidence</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Organic Farming?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="organic_farming" value="yes" class="radio-premium">
                                        <span>🌿 Yes, certified organic</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="organic_farming" value="transitioning" class="radio-premium">
                                        <span>🔄 Transitioning to organic</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="organic_farming" value="no" class="radio-premium">
                                        <span>🧪 No, conventional farming</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Fertilizer Use</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="fertilizer_types" value="synthetic" class="checkbox-premium">
                                        <span>🧪 Synthetic fertilizers</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="fertilizer_types" value="organic" class="checkbox-premium">
                                        <span>🌿 Organic fertilizers</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="fertilizer_types" value="compost" class="checkbox-premium">
                                        <span>🍂 Compost</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="fertilizer_types" value="manure" class="checkbox-premium">
                                        <span>💩 Animal manure</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="fertilizer_types" value="none" class="checkbox-premium">
                                        <span>❌ No fertilizers used</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Pesticide Use</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="pesticide_use" value="frequent" class="radio-premium">
                                        <span>🔄 Frequent use (as needed)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="pesticide_use" value="occasional" class="radio-premium">
                                        <span>⚠️ Occasional use (emergencies)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="pesticide_use" value="natural" class="radio-premium">
                                        <span>🌿 Natural pesticides only</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="pesticide_use" value="none" class="radio-premium">
                                        <span>❌ No pesticides used</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Typical Planting Density (if known)</label>
                            <div class="flex">
                                <input type="number" id="planting_density" name="planting_density" min="0"
                                       class="form-input flex-1 px-6 py-4 rounded-l-xl text-lg border-r-0"
                                       placeholder="Number">
                                <select id="density_unit" name="density_unit" class="form-input px-4 py-4 rounded-r-xl text-lg">
                                    <option value="per_hectare">Per hectare</option>
                                    <option value="per_acre">Per acre</option>
                                    <option value="per_sq_meter">Per square meter</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- G. Livestock & Animal Health Details -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-brown-soil to-yellow-sun rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-cow text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Livestock & Animal Health</h2>
                                <p class="text-gray-600 dark:text-gray-300">Animal management and health monitoring</p>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Livestock Breeds Currently Used</label>
                            <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-64 overflow-y-auto">
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="holstein" class="checkbox-premium"><span>🐄 Holstein (Dairy)</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="jersey" class="checkbox-premium"><span>🐄 Jersey (Dairy)</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="angus" class="checkbox-premium"><span>🐄 Angus (Beef)</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="hereford" class="checkbox-premium"><span>🐄 Hereford (Beef)</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="zebu" class="checkbox-premium"><span>🐄 Zebu</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="boer_goat" class="checkbox-premium"><span>🐐 Boer Goat</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="saanen_goat" class="checkbox-premium"><span>🐐 Saanen Goat</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="dorper_sheep" class="checkbox-premium"><span>🐑 Dorper Sheep</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="merino_sheep" class="checkbox-premium"><span>🐑 Merino Sheep</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="broiler" class="checkbox-premium"><span>🐔 Broiler Chicken</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="layer" class="checkbox-premium"><span>🐔 Layer Chicken</span></label>
                                    <label class="flex items-center space-x-2"><input type="checkbox" name="livestock_breeds" value="local_breeds" class="checkbox-premium"><span>🏠 Local Breeds</span></label>
                                </div>
                            </div>
                            <input type="text" id="other_breeds" name="other_breeds" placeholder="Other breeds (specify)" 
                                   class="form-input w-full px-6 py-4 rounded-xl text-lg mt-4">
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Average Herd/Flock Size</label>
                                <input type="number" id="herd_size" name="herd_size" min="0"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Total number of animals">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you use a veterinarian regularly?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="veterinary_services" value="regular" class="radio-premium">
                                        <span>✅ Yes, regular vet visits</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="veterinary_services" value="emergency" class="radio-premium">
                                        <span>🚨 Only for emergencies</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="veterinary_services" value="none" class="radio-premium">
                                        <span>❌ No veterinary services</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Feed Sources</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="feed_sources" value="own_feed" class="checkbox-premium">
                                        <span>🌾 Own feed production</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="feed_sources" value="purchased_feed" class="checkbox-premium">
                                        <span>🛒 Purchased commercial feed</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="feed_sources" value="pasture" class="checkbox-premium">
                                        <span>🌱 Pasture grazing</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="feed_sources" value="crop_residues" class="checkbox-premium">
                                        <span>🌾 Crop residues</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want AI-driven disease detection?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="ai_disease_detection" value="yes" class="radio-premium">
                                        <span>🤖 Yes, interested in AI disease detection</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="ai_disease_detection" value="no" class="radio-premium">
                                        <span>❌ No, not interested</span>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Upload photos of animals for AI health monitoring</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Typical Vaccination Schedule</label>
                                <textarea id="vaccination_schedule" name="vaccination_schedule" rows="3"
                                          class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                          placeholder="Describe vaccination routine or leave blank"></textarea>
                                <input type="file" id="vaccination_file" name="vaccination_file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg mt-3">
                                <p class="text-xs text-gray-500 mt-1">Upload vaccination schedule file (optional)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you track animal weights/growth digitally?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="digital_tracking" value="yes" class="radio-premium">
                                        <span>📱 Yes, track digitally</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="digital_tracking" value="manual" class="radio-premium">
                                        <span>📝 Manual tracking only</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="digital_tracking" value="none" class="radio-premium">
                                        <span>❌ No tracking</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Technology, Market & Finance -->
                <div id="step-4" class="step-content hidden animate-slide-up">
                    <!-- H. Equipment & Technology -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-primary to-sapphire rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-tools text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Equipment & Technology</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your current technology and equipment setup</p>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you own farm machinery?</label>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="tractor" class="checkbox-premium">
                                    <span>🚜 Tractor</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="harvester" class="checkbox-premium">
                                    <span>🌾 Harvester</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="plough" class="checkbox-premium">
                                    <span>🔧 Plough</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="seeder" class="checkbox-premium">
                                    <span>🌱 Seeder</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="sprayer" class="checkbox-premium">
                                    <span>💨 Sprayer</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="irrigation_pump" class="checkbox-premium">
                                    <span>💧 Irrigation Pump</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="drone" class="checkbox-premium">
                                    <span>🚁 Drone</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="milking_machine" class="checkbox-premium">
                                    <span>🥛 Milking Machine</span>
                                </label>
                                <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                    <input type="checkbox" name="farm_machinery" value="none" class="checkbox-premium">
                                    <span>❌ No machinery</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Do you use smartphones on-farm?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="smartphone_usage" value="yes" required class="radio-premium">
                                        <span>📱 Yes, regularly use smartphone</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="smartphone_usage" value="occasionally" required class="radio-premium">
                                        <span>📲 Occasionally use smartphone</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="smartphone_usage" value="no" required class="radio-premium">
                                        <span>❌ No smartphone</span>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Affects delivery channels for alerts</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Internet Connectivity on Farm</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="internet_connectivity" value="broadband" required class="radio-premium">
                                        <span>🌐 Fixed broadband</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="internet_connectivity" value="mobile" required class="radio-premium">
                                        <span>📶 Mobile data only</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="internet_connectivity" value="intermittent" required class="radio-premium">
                                        <span>⚠️ Intermittent connection</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="internet_connectivity" value="none" required class="radio-premium">
                                        <span>❌ No internet</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Do you use farm management software today?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="farm_software_usage" value="yes" class="radio-premium" onchange="toggleSoftwareName()">
                                        <span>✅ Yes, use farm software</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="farm_software_usage" value="no" class="radio-premium" onchange="toggleSoftwareName()">
                                        <span>❌ No farm software</span>
                                    </label>
                                </div>
                                <div id="software-name" class="hidden mt-4">
                                    <input type="text" id="current_software" name="current_software"
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                           placeholder="Name of software currently used">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you have IoT sensors?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="iot_sensors" value="soil_moisture" class="checkbox-premium">
                                        <span>🌱 Soil moisture sensors</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="iot_sensors" value="weather_station" class="checkbox-premium">
                                        <span>🌤️ Weather station</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="iot_sensors" value="livestock_tracking" class="checkbox-premium">
                                        <span>🐄 Livestock tracking</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="iot_sensors" value="none" class="checkbox-premium">
                                        <span>❌ No IoT sensors</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like to integrate external sensors/APIs?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="external_integration" value="yes" class="radio-premium">
                                    <span>✅ Yes, interested in integrations</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="external_integration" value="no" class="radio-premium">
                                    <span>❌ No, keep it simple</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="external_integration" value="maybe" class="radio-premium">
                                    <span>🤔 Maybe, depends on benefits</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- I. Market & Sales Profile -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-gold to-yellow-sun rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-chart-line text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Market & Sales Profile</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your marketing and sales activities</p>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Do you sell produce?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="sells_produce" value="yes" required class="radio-premium" onchange="toggleSalesChannels()">
                                    <span>💰 Yes, I sell produce</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="sells_produce" value="no" required class="radio-premium" onchange="toggleSalesChannels()">
                                    <span>🏠 No, subsistence only</span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="sales-channels" class="hidden">
                            <div class="mb-8">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Primary Sales Channels</label>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="local_market" class="checkbox-premium">
                                        <span>🏪 Local market</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="aggregator" class="checkbox-premium">
                                        <span>🚚 Aggregator/Middleman</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="direct_consumer" class="checkbox-premium">
                                        <span>👥 Direct to consumer</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="export" class="checkbox-premium">
                                        <span>🌍 Export</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="cooperative" class="checkbox-premium">
                                        <span>🤝 Cooperative</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-gold cursor-pointer">
                                        <input type="checkbox" name="sales_channels" value="online" class="checkbox-premium">
                                        <span>💻 Online marketplace</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want market price alerts?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="price_alerts" value="yes" class="radio-premium">
                                            <span>📈 Yes, want price alerts</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="price_alerts" value="no" class="radio-premium">
                                            <span>❌ No price alerts needed</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want help connecting to buyers?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="buyer_connection" value="yes" class="radio-premium">
                                            <span>🤝 Yes, help me find buyers</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="buyer_connection" value="no" class="radio-premium">
                                            <span>✅ No, I have buyers</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Which commodities are you most interested in selling?</label>
                                <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-48 overflow-y-auto">
                                    <div class="grid grid-cols-3 gap-2">
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="maize" class="checkbox-premium"><span>🌽 Maize</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="wheat" class="checkbox-premium"><span>🌾 Wheat</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="rice" class="checkbox-premium"><span>🍚 Rice</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="beans" class="checkbox-premium"><span>🫘 Beans</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="tomatoes" class="checkbox-premium"><span>🍅 Tomatoes</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="onions" class="checkbox-premium"><span>🧅 Onions</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="potatoes" class="checkbox-premium"><span>🥔 Potatoes</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="milk" class="checkbox-premium"><span>🥛 Milk</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="eggs" class="checkbox-premium"><span>🥚 Eggs</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="meat" class="checkbox-premium"><span>🥩 Meat</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="coffee" class="checkbox-premium"><span>☕ Coffee</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="sell_commodities" value="tea" class="checkbox-premium"><span>🍵 Tea</span></label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8 mt-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you export?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="export_activities" value="yes" class="radio-premium" onchange="toggleExportDetails()">
                                            <span>🌍 Yes, I export</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="export_activities" value="no" class="radio-premium" onchange="toggleExportDetails()">
                                            <span>🏠 No, domestic only</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="export_activities" value="interested" class="radio-premium" onchange="toggleExportDetails()">
                                            <span>🤔 Interested in exporting</span>
                                        </label>
                                    </div>
                                    <div id="export-details" class="hidden mt-4">
                                        <input type="text" id="export_countries" name="export_countries" placeholder="Export countries (comma separated)" 
                                               class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Average Price Received for Main Product</label>
                                    <div class="flex">
                                        <select id="currency" name="currency" class="form-input px-4 py-4 rounded-l-xl border-r-0 text-lg">
                                            <option value="USD">💵 USD</option>
                                            <option value="EUR">💶 EUR</option>
                                            <option value="KES">🇰🇪 KES</option>
                                            <option value="NGN">🇳🇬 NGN</option>
                                            <option value="ZAR">🇿🇦 ZAR</option>
                                            <option value="INR">🇮🇳 INR</option>
                                            <option value="BRL">🇧🇷 BRL</option>
                                        </select>
                                        <input type="number" id="average_price" name="average_price" min="0" step="0.01"
                                               class="form-input flex-1 px-6 py-4 rounded-r-xl text-lg border-l-0"
                                               placeholder="0.00">
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Average price per unit for main product</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- J. Finance, Insurance & Grants -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-yellow-sun to-gold rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-coins text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Finance, Insurance & Grants</h2>
                                <p class="text-gray-600 dark:text-gray-300">Financial services and support options</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you interested in farm financing options?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="financing_interest" value="yes" class="radio-premium">
                                        <span>💰 Yes, interested in financing</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="financing_interest" value="no" class="radio-premium">
                                        <span>❌ No financing needed</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="financing_interest" value="maybe" class="radio-premium">
                                        <span>🤔 Maybe, depends on terms</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you currently have a loan?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="current_loan" value="yes" class="radio-premium" onchange="toggleLoanDetails()">
                                        <span>📄 Yes, have active loans</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="current_loan" value="no" class="radio-premium" onchange="toggleLoanDetails()">
                                        <span>✅ No current loans</span>
                                    </label>
                                </div>
                                <div id="loan-details" class="hidden mt-4">
                                    <input type="text" id="loan_details_text" name="loan_details_text" placeholder="Loan details (optional)" 
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like micro-insurance recommendations?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="microinsurance_interest" value="yes" class="radio-premium">
                                        <span>🛡️ Yes, interested in micro-insurance</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="microinsurance_interest" value="no" class="radio-premium">
                                        <span>❌ No insurance interest</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="microinsurance_interest" value="have" class="radio-premium">
                                        <span>✅ Already have insurance</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you interested in grants/subsidies?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="grants_interest" value="yes" class="radio-premium">
                                        <span>🎁 Yes, help me find grants</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="grants_interest" value="no" class="radio-premium">
                                        <span>❌ No interest in grants</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 required">Preferred Payment Currency</label>
                            <select id="payment_currency" name="payment_currency" required class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                <option value="">Select currency</option>
                                <option value="USD">💵 USD - US Dollar</option>
                                <option value="EUR">💶 EUR - Euro</option>
                                <option value="KES">🇰🇪 KES - Kenyan Shilling</option>
                                <option value="NGN">🇳🇬 NGN - Nigerian Naira</option>
                                <option value="ZAR">🇿🇦 ZAR - South African Rand</option>
                                <option value="INR">🇮🇳 INR - Indian Rupee</option>
                                <option value="BRL">🇧🇷 BRL - Brazilian Real</option>
                                <option value="GBP">🇬🇧 GBP - British Pound</option>
                                <option value="CAD">🇨🇦 CAD - Canadian Dollar</option>
                                <option value="AUD">🇦🇺 AUD - Australian Dollar</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Required for marketplace transactions</p>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Skills, Community, Goals & Verification -->
                <div id="step-5" class="step-content hidden animate-slide-up">
                    <!-- K. Capacity, Skills & Training -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-emerald to-green-earth rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-graduation-cap text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Capacity, Skills & Training</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your experience and learning preferences</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Education Level</label>
                                <select id="education_level" name="education_level" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select education level</option>
                                    <option value="primary">🎓 Primary education</option>
                                    <option value="secondary">🎓 Secondary education</option>
                                    <option value="diploma">📜 Diploma/Certificate</option>
                                    <option value="bachelor">🎓 Bachelor's degree</option>
                                    <option value="master">🎓 Master's degree</option>
                                    <option value="phd">👨‍🎓 PhD/Doctorate</option>
                                    <option value="other">📚 Other</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 required">Farming Experience (years)</label>
                                <input type="number" id="farming_experience" name="farming_experience" required min="0" max="80"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Years of farming experience">
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you have staff/employees?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="has_staff" value="yes" class="radio-premium" onchange="toggleStaffCount()">
                                        <span>👥 Yes, have staff/employees</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="has_staff" value="no" class="radio-premium" onchange="toggleStaffCount()">
                                        <span>👤 No, work alone/family only</span>
                                    </label>
                                </div>
                                <div id="staff-count" class="hidden mt-4">
                                    <input type="number" id="staff_count" name="staff_count" min="1"
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                           placeholder="Number of staff/employees">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you interested in training programs?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="training_interest" value="yes" class="radio-premium" onchange="toggleTrainingTopics()">
                                        <span>📚 Yes, interested in training</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="training_interest" value="no" class="radio-premium" onchange="toggleTrainingTopics()">
                                        <span>❌ No training interest</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="training-topics" class="hidden mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Training Topics of Interest</label>
                            <div class="grid md:grid-cols-2 gap-4">
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-emerald cursor-pointer">
                                    <input type="checkbox" name="training_topics" value="climate_smart_agriculture" class="checkbox-premium">
                                    <span>🌱 Climate-smart agriculture</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-emerald cursor-pointer">
                                    <input type="checkbox" name="training_topics" value="technology_adoption" class="checkbox-premium">
                                    <span>💻 Technology adoption</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-emerald cursor-pointer">
                                    <input type="checkbox" name="training_topics" value="financial_management" class="checkbox-premium">
                                    <span>💰 Financial management</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-emerald cursor-pointer">
                                    <input type="checkbox" name="training_topics" value="market_access" class="checkbox-premium">
                                    <span>📈 Market access</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Do you have certificates?</label>
                                <textarea id="certificates" name="certificates" rows="3"
                                          class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                          placeholder="List any agronomy, animal health, or other certificates"></textarea>
                                <input type="file" id="certificates_file" name="certificates_file" multiple accept=".pdf,.jpg,.jpeg,.png" 
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg mt-3">
                                <p class="text-xs text-gray-500 mt-1">Upload certificate files (optional)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Preferred Learning Style</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="learning_style" value="video" class="radio-premium">
                                        <span>📹 Video tutorials</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="learning_style" value="text" class="radio-premium">
                                        <span>📖 Text/Written guides</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="learning_style" value="audio" class="radio-premium">
                                        <span>🎧 Audio/Podcasts</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="learning_style" value="in_person" class="radio-premium">
                                        <span>👥 In-person training</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- L. Community & Networking -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-sapphire to-blue-sky rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-users text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Community & Networking</h2>
                                <p class="text-gray-600 dark:text-gray-300">Connect with fellow farmers and experts</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like to be visible in the community directory?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="community_visible" value="yes" class="radio-premium">
                                        <span>👁️ Yes, make me visible</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="community_visible" value="no" class="radio-premium">
                                        <span>🔒 No, keep me private</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like mentorship pairings?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="mentorship_interest" value="mentor" class="radio-premium">
                                        <span>👨‍🏫 I want to be a mentor</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="mentorship_interest" value="mentee" class="radio-premium">
                                        <span>👨‍🎓 I want to find a mentor</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="mentorship_interest" value="both" class="radio-premium">
                                        <span>🤝 Both mentor and mentee</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="mentorship_interest" value="no" class="radio-premium">
                                        <span>❌ No mentorship interest</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Topics you want to discuss in forums</label>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="crop_management" class="checkbox-premium">
                                    <span>🌱 Crop management</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="livestock_care" class="checkbox-premium">
                                    <span>🐄 Livestock care</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="market_trends" class="checkbox-premium">
                                    <span>📈 Market trends</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="technology" class="checkbox-premium">
                                    <span>💻 Technology</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="sustainability" class="checkbox-premium">
                                    <span>🌍 Sustainability</span>
                                </label>
                                <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-sapphire cursor-pointer">
                                    <input type="checkbox" name="forum_topics" value="finance" class="checkbox-premium">
                                    <span>💰 Finance</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want peer alerts (neighbor activity)?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="peer_alerts" value="yes" class="radio-premium">
                                    <span>🔔 Yes, notify me of neighbor activities</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="peer_alerts" value="no" class="radio-premium">
                                    <span>🔕 No peer alerts</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- M. Preferences, Accessibility & Languages -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-primary to-emerald rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-cog text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Preferences & Accessibility</h2>
                                <p class="text-gray-600 dark:text-gray-300">Customize your experience</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Preferred Language(s)</label>
                                <div class="border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-32 overflow-y-auto">
                                    <div class="grid grid-cols-1 gap-2">
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="en" class="checkbox-premium" checked><span>🇺🇸 English</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="es" class="checkbox-premium"><span>🇪🇸 Spanish</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="fr" class="checkbox-premium"><span>🇫🇷 French</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="sw" class="checkbox-premium"><span>🇰🇪 Kiswahili</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="pt" class="checkbox-premium"><span>🇧🇷 Portuguese</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="ar" class="checkbox-premium"><span>🇸🇦 Arabic</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="hi" class="checkbox-premium"><span>🇮🇳 Hindi</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_languages" value="zh" class="checkbox-premium"><span>🇨🇳 Chinese</span></label>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Accessibility Needs</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="accessibility_needs" value="screen_reader" class="checkbox-premium">
                                        <span>🔊 Screen reader support</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="accessibility_needs" value="large_text" class="checkbox-premium">
                                        <span>🔍 Large text/high contrast</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="accessibility_needs" value="captions" class="checkbox-premium">
                                        <span>📝 Captions for videos</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" name="accessibility_needs" value="keyboard_nav" class="checkbox-premium">
                                        <span>⌨️ Keyboard navigation</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4 required">Default UI Mode</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="ui_mode" value="light" required class="radio-premium">
                                        <span>☀️ Light mode</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="ui_mode" value="dark" required class="radio-premium">
                                        <span>🌙 Dark mode</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="ui_mode" value="auto" required class="radio-premium">
                                        <span>🔄 Auto (system preference)</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Font Size Preference</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="font_size" value="small" class="radio-premium">
                                        <span>📏 Small</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="font_size" value="medium" class="radio-premium">
                                        <span>📏 Medium</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="font_size" value="large" class="radio-premium">
                                        <span>📏 Large</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Voice Assistant Enabled?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="voice_assistant" value="yes" class="radio-premium">
                                        <span>🎤 Yes, enable voice assistant</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="voice_assistant" value="no" class="radio-premium">
                                        <span>❌ No voice assistant</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Do you want local language voice notifications?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="voice_notifications" value="yes" class="radio-premium" onchange="toggleVoiceLanguage()">
                                        <span>🔊 Yes, voice notifications</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="voice_notifications" value="no" class="radio-premium" onchange="toggleVoiceLanguage()">
                                        <span>🔇 No voice notifications</span>
                                    </label>
                                </div>
                                <div id="voice-language" class="hidden mt-4">
                                    <select id="voice_language" name="voice_language" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                        <option value="">Select voice language</option>
                                        <option value="en">🇺🇸 English</option>
                                        <option value="es">🇪🇸 Spanish</option>
                                        <option value="fr">🇫🇷 French</option>
                                        <option value="sw">🇰🇪 Kiswahili</option>
                                        <option value="pt">🇧🇷 Portuguese</option>
                                        <option value="ar">🇸🇦 Arabic</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- N. Notifications & Privacy Consents -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-earth to-emerald rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-shield-alt text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Privacy & Consents</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your data, your choices</p>
                            </div>
                        </div>
                        
                        <div class="space-y-8">
                            <div class="p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                                <h3 class="font-semibold mb-4 text-blue-800 dark:text-blue-200">Data Usage & Privacy Policy</h3>
                                <p class="text-sm text-blue-700 dark:text-blue-300 mb-6">
                                    We use your data to provide personalized farming recommendations, weather alerts, and market insights. 
                                    Your privacy is important to us, and we follow strict data protection standards.
                                </p>
                                
                                <div class="space-y-4">
                                    <label class="flex items-start space-x-3">
                                        <input type="checkbox" name="marketing_emails" class="checkbox-premium mt-1">
                                        <span class="text-sm">
                                            <strong>Receive marketing emails?</strong> (Optional) 
                                            <br><span class="text-gray-600 dark:text-gray-400">Get updates about new features, farming tips, and platform news</span>
                                        </span>
                                    </label>
                                    
                                    <label class="flex items-start space-x-3">
                                        <input type="checkbox" name="alert_consent" required class="checkbox-premium mt-1">
                                        <span class="text-sm">
                                            <strong>Consent to weather/push alerts?</strong> (Required) 
                                            <br><span class="text-gray-600 dark:text-gray-400">Time-sensitive notifications for weather warnings and farming alerts</span>
                                        </span>
                                    </label>
                                    
                                    <label class="flex items-start space-x-3">
                                        <input type="checkbox" name="research_consent" class="checkbox-premium mt-1">
                                        <span class="text-sm">
                                            <strong>Consent to share anonymized data for research?</strong> (Optional) 
                                            <br><span class="text-gray-600 dark:text-gray-400">Help improve agricultural practices globally through anonymized data sharing</span>
                                        </span>
                                    </label>
                                    
                                    <label class="flex items-start space-x-3">
                                        <input type="checkbox" name="location_sharing" class="checkbox-premium mt-1">
                                        <span class="text-sm">
                                            <strong>Consent to share location with partners for market matching?</strong> (Optional) 
                                            <br><span class="text-gray-600 dark:text-gray-400">Enable location-based buyer connections and regional market insights</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <label class="flex items-start space-x-3">
                                    <input type="checkbox" name="agree_terms" required class="checkbox-premium mt-1">
                                    <span class="text-sm">
                                        <strong>I agree to the <a href="#" class="text-primary hover:underline">Terms & Conditions</a></strong> (Required)
                                        <br><span class="text-gray-600 dark:text-gray-400">Terms of service and platform usage agreement</span>
                                    </span>
                                </label>
                                
                                <label class="flex items-start space-x-3">
                                    <input type="checkbox" name="agree_privacy" required class="checkbox-premium mt-1">
                                    <span class="text-sm">
                                        <strong>I agree to the <a href="#" class="text-primary hover:underline">Privacy Policy</a></strong> (Required)
                                        <br><span class="text-gray-600 dark:text-gray-400">How we collect, use, and protect your personal data</span>
                                    </span>
                                </label>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Data Retention Preference</label>
                                <select id="data_retention" name="data_retention" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="standard">📅 Standard (as per policy - 7 years)</option>
                                    <option value="extended">📈 Extended (for research - 10 years)</option>
                                    <option value="minimal">⏰ Minimal (basic service only - 3 years)</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">How long to keep your data in our systems</p>
                            </div>
                        </div>
                    </div>

                    <!-- O. Verification & Trust (Optional) -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-gold to-yellow-sun rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-certificate text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Verification & Trust</h2>
                                <p class="text-gray-600 dark:text-gray-300">Optional verification for marketplace actions</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Government ID (Optional Verification)</label>
                                <select id="government_id_type" name="government_id_type" class="form-input w-full px-6 py-4 rounded-xl text-lg mb-3" onchange="toggleIdUpload()">
                                    <option value="">Select ID type (optional)</option>
                                    <option value="national_id">🆔 National ID</option>
                                    <option value="passport">📘 Passport</option>
                                    <option value="drivers_license">🚗 Driver's License</option>
                                    <option value="other">📄 Other Government ID</option>
                                </select>
                                <div id="id-upload" class="hidden">
                                    <input type="file" id="government_id_file" name="government_id_file" accept=".pdf,.jpg,.jpeg,.png" 
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <p class="text-xs text-gray-500 mt-1">For high-trust marketplace actions only</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Business Registration Number</label>
                                <input type="text" id="business_registration" name="business_registration"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Business registration number (if commercial)">
                                <p class="text-xs text-gray-500 mt-1">For commercial farming operations</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Bank Account Number</label>
                                <input type="text" id="bank_account" name="bank_account"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="For marketplace payouts (optional)">
                                <p class="text-xs text-gray-500 mt-1">Only when selling through marketplace</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Tax/VAT Number</label>
                                <input type="text" id="tax_number" name="tax_number"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Tax identification number (optional)">
                                <p class="text-xs text-gray-500 mt-1">For tax reporting compliance</p>
                            </div>
                        </div>
                    </div>

                    <!-- P. Emergency & Support Contacts -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-phone text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Emergency & Support Contacts</h2>
                                <p class="text-gray-600 dark:text-gray-300">Important contacts for assistance</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Primary Emergency Contact</label>
                                <input type="text" id="emergency_contact_name" name="emergency_contact_name"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg mb-3"
                                       placeholder="Emergency contact name">
                                <input type="tel" id="emergency_contact_phone" name="emergency_contact_phone"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Emergency contact phone">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Local Extension Agent / Agronomist Contact</label>
                                <input type="text" id="extension_agent_contact" name="extension_agent_contact"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Local agricultural expert contact">
                                <p class="text-xs text-gray-500 mt-1">Local agricultural advisor or extension officer</p>
                            </div>
                        </div>
                    </div>

                    <!-- Q. Goals & Outcomes -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-primary to-sapphire rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-target text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Goals & Outcomes</h2>
                                <p class="text-gray-600 dark:text-gray-300">Your farming aspirations and challenges</p>
                            </div>
                        </div>
                        
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">What are your top 3 farming goals for the next 12 months?</label>
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="increase_yield" class="checkbox-premium">
                                        <span>📈 Increase crop yields</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="reduce_costs" class="checkbox-premium">
                                        <span>💰 Reduce production costs</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="improve_quality" class="checkbox-premium">
                                        <span>⭐ Improve product quality</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="expand_acreage" class="checkbox-premium">
                                        <span>🌾 Expand farm acreage</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="new_markets" class="checkbox-premium">
                                        <span>🎯 Access new markets</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="farming_goals" value="sustainability" class="checkbox-premium">
                                        <span>🌍 Improve sustainability</span>
                                    </label>
                                </div>
                                <textarea id="custom_goals" name="custom_goals" rows="3"
                                          class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                          placeholder="Describe your specific goals in detail"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">What are your biggest challenges right now?</label>
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="drought" class="checkbox-premium">
                                        <span>🌵 Drought/water scarcity</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="pests" class="checkbox-premium">
                                        <span>🐛 Pests and diseases</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="market_access" class="checkbox-premium">
                                        <span>🏪 Market access</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="finance" class="checkbox-premium">
                                        <span>💳 Financial constraints</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="labor" class="checkbox-premium">
                                        <span>👥 Labor shortage</span>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:border-primary cursor-pointer">
                                        <input type="checkbox" name="biggest_challenges" value="climate_change" class="checkbox-premium">
                                        <span>🌡️ Climate change impacts</span>
                                    </label>
                                </div>
                                <textarea id="custom_challenges" name="custom_challenges" rows="3"
                                          class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                          placeholder="Describe other challenges you're facing"></textarea>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Desired Income Growth % (annual)</label>
                                    <input type="number" id="income_growth_target" name="income_growth_target" min="0" max="1000"
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                           placeholder="Target growth percentage">
                                    <p class="text-xs text-gray-500 mt-1">Annual income growth target (optional)</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you aiming to scale/export/industrialize?</label>
                                    <div class="space-y-3">
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="scaling_plans" value="yes" class="radio-premium" onchange="toggleScalingDetails()">
                                            <span>📈 Yes, planning to scale up</span>
                                        </label>
                                        <label class="flex items-center space-x-3">
                                            <input type="radio" name="scaling_plans" value="no" class="radio-premium" onchange="toggleScalingDetails()">
                                            <span>📊 No, maintain current scale</span>
                                        </label>
                                    </div>
                                    <div id="scaling-details" class="hidden mt-4">
                                        <textarea id="scaling_details_text" name="scaling_details_text" rows="3"
                                                  class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                                  placeholder="Describe your scaling plans"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- R. Integrations & APIs -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-emerald to-green-earth rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-plug text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Integrations & APIs</h2>
                                <p class="text-gray-600 dark:text-gray-300">Connect with external services and devices</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Connect to WhatsApp / Telegram for alerts?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="messaging_integration" value="whatsapp" class="radio-premium">
                                        <span>💬 Connect WhatsApp</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="messaging_integration" value="telegram" class="radio-premium">
                                        <span>✈️ Connect Telegram</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="messaging_integration" value="both" class="radio-premium">
                                        <span>🤝 Connect both</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="messaging_integration" value="none" class="radio-premium">
                                        <span>❌ No messaging integration</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Allow device sensor integration?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="device_integration" value="yes" class="radio-premium">
                                        <span>📡 Yes, connect sensors (Bluetooth/LoRa)</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="device_integration" value="no" class="radio-premium">
                                        <span>❌ No device integration</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like to import data from CSV/Excel?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="data_import" value="yes" class="radio-premium" onchange="toggleDataUpload()">
                                    <span>📊 Yes, upload existing farm data</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="data_import" value="no" class="radio-premium" onchange="toggleDataUpload()">
                                    <span>❌ No, start fresh</span>
                                </label>
                            </div>
                            <div id="data-upload" class="hidden mt-4">
                                <input type="file" id="data_import_file" name="data_import_file" accept=".csv,.xlsx,.xls" 
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                <p class="text-xs text-gray-500 mt-1">Upload CSV or Excel file with your farm data</p>
                            </div>
                        </div>
                    </div>

                    <!-- S. Optional Demographic & Impact Survey -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-chart-pie text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Demographic & Impact Survey</h2>
                                <p class="text-gray-600 dark:text-gray-300">Optional - helps us understand our community</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Age Range (Optional)</label>
                                <select id="age_range" name="age_range" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select age range</option>
                                    <option value="18-25">18-25 years</option>
                                    <option value="26-35">26-35 years</option>
                                    <option value="36-45">36-45 years</option>
                                    <option value="46-55">46-55 years</option>
                                    <option value="56-65">56-65 years</option>
                                    <option value="65+">65+ years</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Gender (Optional)</label>
                                <select id="gender" name="gender" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="non_binary">Non-binary</option>
                                    <option value="prefer_not_to_say">Prefer not to say</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Household Size</label>
                                <input type="number" id="household_size" name="household_size" min="1" max="20"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Number of people in household">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Farm Classification</label>
                                <select id="farm_classification" name="farm_classification" class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">How do you classify your farm?</option>
                                    <option value="smallholder">🏡 Smallholder</option>
                                    <option value="medium">🏘️ Medium scale</option>
                                    <option value="large">🏭 Large scale</option>
                                    <option value="industrial">🏢 Industrial</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Are you part of a cooperative?</label>
                            <div class="space-y-3">
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="cooperative_member" value="yes" class="radio-premium" onchange="toggleCooperativeName()">
                                    <span>🤝 Yes, member of cooperative</span>
                                </label>
                                <label class="flex items-center space-x-3">
                                    <input type="radio" name="cooperative_member" value="no" class="radio-premium" onchange="toggleCooperativeName()">
                                    <span>👤 No, independent farmer</span>
                                </label>
                            </div>
                            <div id="cooperative-name" class="hidden mt-4">
                                <input type="text" id="cooperative_name" name="cooperative_name"
                                       class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                       placeholder="Name of your cooperative">
                            </div>
                        </div>
                    </div>

                    <!-- T. UX / Onboarding Preferences -->
                    <div class="premium-card p-10 rounded-3xl mb-10">
                        <div class="flex items-center mb-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl flex items-center justify-center mr-4">
                                <i class="fas fa-rocket text-white text-2xl"></i>
                            </div>
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Onboarding Preferences</h2>
                                <p class="text-gray-600 dark:text-gray-300">How did you find us and how can we help?</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">How did you hear about Agriclimate Connect?</label>
                                <select id="referral_source" name="referral_source" class="form-input w-full px-6 py-4 rounded-xl text-lg" onchange="toggleReferralOther()">
                                    <option value="">Select source</option>
                                    <option value="search_engine">🔍 Search engine (Google, etc.)</option>
                                    <option value="social_media">📱 Social media</option>
                                    <option value="friend_referral">👥 Friend/colleague referral</option>
                                    <option value="agricultural_event">🌾 Agricultural event/conference</option>
                                    <option value="government_program">🏛️ Government program</option>
                                    <option value="ngo_organization">🤝 NGO/Organization</option>
                                    <option value="news_article">📰 News article</option>
                                    <option value="advertisement">📺 Advertisement</option>
                                    <option value="other">📝 Other</option>
                                </select>
                                <div id="referral-other" class="hidden mt-3">
                                    <input type="text" id="referral_other_text" name="referral_other_text"
                                           class="form-input w-full px-6 py-4 rounded-xl text-lg"
                                           placeholder="Please specify">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Would you like a personalized onboarding call/demo?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="onboarding_call" value="yes" class="radio-premium" onchange="toggleCallTimes()">
                                        <span>📞 Yes, schedule a call</span>
                                    </label>
                                    <label class="flex items-center space-x-3">
                                        <input type="radio" name="onboarding_call" value="no" class="radio-premium" onchange="toggleCallTimes()">
                                        <span>💻 No, I'll explore on my own</span>
                                    </label>
                                </div>
                                <div id="call-times" class="hidden mt-4">
                                    <label class="block text-xs text-gray-500 mb-2">Preferred call times</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_call_times" value="morning" class="checkbox-premium"><span>🌅 Morning</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_call_times" value="afternoon" class="checkbox-premium"><span>☀️ Afternoon</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_call_times" value="evening" class="checkbox-premium"><span>🌆 Evening</span></label>
                                        <label class="flex items-center space-x-2"><input type="checkbox" name="preferred_call_times" value="weekend" class="checkbox-premium"><span>🗓️ Weekend</span></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 required">Time Zone</label>
                                <select id="time_zone" name="time_zone" required class="form-input w-full px-6 py-4 rounded-xl text-lg">
                                    <option value="">Select your time zone</option>
                                    <option value="UTC-12">(UTC-12) Baker Island</option>
                                    <option value="UTC-11">(UTC-11) Hawaii</option>
                                    <option value="UTC-10">(UTC-10) Alaska</option>
                                    <option value="UTC-9">(UTC-9) Pacific Time</option>
                                    <option value="UTC-8">(UTC-8) Mountain Time</option>
                                    <option value="UTC-7">(UTC-7) Central Time</option>
                                    <option value="UTC-6">(UTC-6) Eastern Time</option>
                                    <option value="UTC-5">(UTC-5) Colombia, Peru</option>
                                    <option value="UTC-4">(UTC-4) Atlantic Time</option>
                                    <option value="UTC-3">(UTC-3) Brazil, Argentina</option>
                                    <option value="UTC-2">(UTC-2) Mid-Atlantic</option>
                                    <option value="UTC-1">(UTC-1) Azores</option>
                                    <option value="UTC+0">(UTC+0) GMT - London</option>
                                    <option value="UTC+1">(UTC+1) Central Europe</option>
                                    <option value="UTC+2">(UTC+2) Eastern Europe</option>
                                    <option value="UTC+3">(UTC+3) East Africa - Kenya</option>
                                    <option value="UTC+4">(UTC+4) Gulf States</option>
                                    <option value="UTC+5">(UTC+5) Pakistan</option>
                                    <option value="UTC+5:30">(UTC+5:30) India</option>
                                    <option value="UTC+6">(UTC+6) Bangladesh</option>
                                    <option value="UTC+7">(UTC+7) Southeast Asia</option>
                                    <option value="UTC+8">(UTC+8) China, Philippines</option>
                                    <option value="UTC+9">(UTC+9) Japan, Korea</option>
                                    <option value="UTC+10">(UTC+10) Australia East</option>
                                    <option value="UTC+11">(UTC+11) Pacific Islands</option>
                                    <option value="UTC+12">(UTC+12) New Zealand</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Preferred notification times</label>
                                <div class="space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm w-16">From:</label>
                                        <input type="time" id="notification_start" name="notification_start"
                                               class="form-input px-3 py-2 rounded-lg text-sm flex-1"
                                               value="06:00">
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm w-16">To:</label>
                                        <input type="time" id="notification_end" name="notification_end"
                                               class="form-input px-3 py-2 rounded-lg text-sm flex-1"
                                               value="22:00">
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Do not disturb hours - notifications will be queued</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between items-center mt-16 p-8 glass-morphism rounded-3xl">
                    <button type="button" id="prev-btn" onclick="previousStep()" 
                            class="hidden px-10 py-4 border-2 border-white/30 text-white rounded-xl hover:bg-white/10 transition-all text-lg font-semibold">
                        <i class="fas fa-arrow-left mr-3"></i>Previous
                    </button>
                    
                    <div class="flex-1"></div>
                    
                    <button type="button" id="next-btn" onclick="nextStep()" 
                            class="premium-button text-white px-10 py-4 rounded-xl text-lg font-semibold">
                        Next Step<i class="fas fa-arrow-right ml-3"></i>
                    </button>
                    
                    <button type="submit" id="submit-btn" 
                            class="hidden premium-button text-white px-10 py-4 rounded-xl text-lg font-semibold">
                        <i class="fas fa-rocket mr-3"></i>Launch My Farm Profile
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center premium-gradient">
        <div class="premium-card p-12 rounded-3xl text-center max-w-md w-full mx-4">
            <div class="w-20 h-20 mx-auto mb-6">
                <div class="w-full h-full border-4 border-green-earth border-t-transparent rounded-full animate-spin"></div>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Creating Your Agricultural Profile</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-6">Setting up your personalized farming intelligence platform...</p>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                <div id="loading-progress" class="bg-gradient-to-r from-green-earth to-emerald h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div id="loading-text" class="text-sm text-gray-500 dark:text-gray-400 mt-3">Initializing...</div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-24 right-6 z-50 space-y-4"></div>

    <script>
        // Supabase Configuration - Replace with your actual values
        const SUPABASE_URL = 'https://jjmgjyykxfzpwevoockl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqbWdqeXlreGZ6cHdldm9vY2tsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwODgxNDIsImV4cCI6MjA3NTY2NDE0Mn0.pFlDfhfldWLr3cBwZP47DhnRF9PbXX6O5e-E-cng19I';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        

        // Global variables
        let currentStep = 1;
        const totalSteps = 5;
        let formData = {};
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeDarkMode();
            updateStepDisplay();
            preloadCountryData();
            autoDetectTimeZone();
        });

        // Dark mode initialization
        function initializeDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
        }

        // Auto-detect timezone
        function autoDetectTimeZone() {
            try {
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const offset = new Date().getTimezoneOffset();
                const utcOffset = -offset / 60;
                
                // Map to our UTC format
                let utcString = 'UTC';
                if (utcOffset !== 0) {
                    utcString += utcOffset > 0 ? '+' + utcOffset : utcOffset;
                }
                
                const timeZoneSelect = document.getElementById('time_zone');
                if (timeZoneSelect) {
                    // Try to find a matching option
                    for (let option of timeZoneSelect.options) {
                        if (option.value.includes(utcString)) {
                            option.selected = true;
                            break;
                        }
                    }
                }
            } catch (error) {
                console.log('Could not auto-detect timezone');
            }
        }

        // Form validation functions
        function validateEmail() {
            const email = document.getElementById('email').value;
            const validation = document.getElementById('email-validation');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email && !emailRegex.test(email)) {
                validation.innerHTML = '<span class="text-red-500"><i class="fas fa-times-circle mr-1"></i>Invalid email format</span>';
                return false;
            } else if (email && emailRegex.test(email)) {
                validation.innerHTML = '<span class="text-green-500"><i class="fas fa-check-circle mr-1"></i>Valid email format</span>';
                return true;
            } else {
                validation.innerHTML = '';
                return true;
            }
        }

        function checkPasswordStrength() {
            const password = document.getElementById('password').value;
            const strengthBar = document.getElementById('password-strength');
            const strengthText = document.getElementById('password-text');
            
            let strength = 0;
            let message = '';
            let requirements = [];
            
            if (password.length >= 8) {
                strength++;
            } else {
                requirements.push('8+ characters');
            }
            
            if (password.match(/[a-z]+/)) {
                strength++;
            } else {
                requirements.push('lowercase letter');
            }
            
            if (password.match(/[A-Z]+/)) {
                strength++;
            } else {
                requirements.push('uppercase letter');
            }
            
            if (password.match(/[0-9]+/)) {
                strength++;
            } else {
                requirements.push('number');
            }
            
            if (password.match(/[$@#&!%*?&]+/)) {
                strength++;
            } else {
                requirements.push('special character');
            }
            
            strengthBar.className = 'password-strength ';
            
            switch (strength) {
                case 0:
                case 1:
                    strengthBar.classList.add('strength-weak');
                    message = `<span class="text-red-500">Weak password</span>`;
                    break;
                case 2:
                case 3:
                    strengthBar.classList.add('strength-fair');
                    message = `<span class="text-yellow-500">Fair password</span>`;
                    break;
                case 4:
                    strengthBar.classList.add('strength-good');
                    message = `<span class="text-green-500">Good password</span>`;
                    break;
                case 5:
                    strengthBar.classList.add('strength-strong');
                    message = `<span class="text-emerald-500">Strong password</span>`;
                    break;
            }
            
            if (requirements.length > 0) {
                message += ` <span class="text-gray-500">- Missing: ${requirements.join(', ')}</span>`;
            }
            
            strengthText.innerHTML = message;
            
            return strength >= 4;
        }

        function checkPasswordMatch() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const matchDiv = document.getElementById('password-match');
            
            if (confirmPassword.length === 0) {
                matchDiv.innerHTML = '';
                return true;
            }
            
            if (password === confirmPassword) {
                matchDiv.innerHTML = '<span class="text-green-500"><i class="fas fa-check-circle mr-1"></i>Passwords match</span>';
                return true;
            } else {
                matchDiv.innerHTML = '<span class="text-red-500"><i class="fas fa-times-circle mr-1"></i>Passwords do not match</span>';
                return false;
            }
        }

        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const eye = document.getElementById(fieldId + '-eye');
            
            if (field.type === 'password') {
                field.type = 'text';
                eye.classList.remove('fa-eye');
                eye.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                eye.classList.remove('fa-eye-slash');
                eye.classList.add('fa-eye');
            }
        }

        // Profile photo preview
        function previewProfilePhoto() {
            const file = document.getElementById('profile_photo').files[0];
            const preview = document.getElementById('profile-preview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="w-32 h-32 rounded-full object-cover shadow-lg">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Location functions
        function getCurrentLocation() {
            showNotification('Detecting your location...', 'info');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                        showNotification('Location detected successfully!', 'success');
                    },
                    function(error) {
                        showNotification('Could not detect location. Please enter manually.', 'warning');
                    }
                );
            } else {
                showNotification('Geolocation is not supported by this browser.', 'error');
            }
        }

        function preloadCountryData() {
            // This would be replaced with actual API calls in production
            window.countryData = {
                'US': {
                    states: [
                        'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 
                        'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho',
                        'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
                        'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 
                        'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada',
                        'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 
                        'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon',
                        'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota',
                        'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington',
                        'West Virginia', 'Wisconsin', 'Wyoming'
                    ]
                },
                'KE': {
                    states: [
                        'Nairobi', 'Mombasa', 'Nakuru', 'Eldoret', 'Kisumu', 'Thika', 'Malindi',
                        'Kitale', 'Garissa', 'Nyeri', 'Machakos', 'Meru', 'Embu', 'Lamu'
                    ]
                },
                'NG': {
                    states: [
                        'Lagos', 'Kano', 'Ibadan', 'Kaduna', 'Port Harcourt', 'Benin City',
                        'Maiduguri', 'Zaria', 'Aba', 'Jos', 'Ilorin', 'Oyo', 'Enugu',
                        'Abeokuta', 'Abuja', 'Sokoto', 'Onitsha', 'Warri', 'Okene'
                    ]
                },
                'IN': {
                    states: [
                        'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh',
                        'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka',
                        'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya',
                        'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim',
                        'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand',
                        'West Bengal'
                    ]
                },
                'BR': {
                    states: [
                        'Acre', 'Alagoas', 'Amapá', 'Amazonas', 'Bahia', 'Ceará', 'Distrito Federal',
                        'Espírito Santo', 'Goiás', 'Maranhão', 'Mato Grosso', 'Mato Grosso do Sul',
                        'Minas Gerais', 'Pará', 'Paraíba', 'Paraná', 'Pernambuco', 'Piauí',
                        'Rio de Janeiro', 'Rio Grande do Norte', 'Rio Grande do Sul', 'Rondônia',
                        'Roraima', 'Santa Catarina', 'São Paulo', 'Sergipe', 'Tocantins'
                    ]
                }
                // Add more countries as needed
            };
        }

        function loadStates() {
            const country = document.getElementById('country').value;
            const stateSelect = document.getElementById('state');
            
            stateSelect.innerHTML = '<option value="">Select state/region</option>';
            
            if (window.countryData[country] && window.countryData[country].states) {
                window.countryData[country].states.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state.toLowerCase().replace(/\s+/g, '_');
                    option.textContent = state;
                    stateSelect.appendChild(option);
                });
            }
        }

        // Dynamic form toggles
        function toggleLivestockNumbers() {
            const selectedTypes = document.querySelectorAll('input[name="livestock_types"]:checked');
            const numbersDiv = document.getElementById('livestock-numbers');
            const inputsDiv = document.getElementById('livestock-count-inputs');
            
            if (selectedTypes.length > 0) {
                numbersDiv.classList.remove('hidden');
                inputsDiv.innerHTML = '';
                
                selectedTypes.forEach(type => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label class="block text-sm font-medium mb-2">${type.value.charAt(0).toUpperCase() + type.value.slice(1)} Count</label>
                        <input type="number" id="${type.value}_number" name="${type.value}_number" min="0"
                               class="form-input w-full px-4 py-3 rounded-xl text-lg"
                               placeholder="Number of ${type.value}">
                    `;
                    inputsDiv.appendChild(div);
                });
            } else {
                numbersDiv.classList.add('hidden');
            }
        }

        function toggleGreenhouseSize() {
            const hasGreenhouse = document.querySelector('input[name="has_greenhouse"]:checked');
            const sizeDiv = document.getElementById('greenhouse-size');
            
            if (hasGreenhouse && hasGreenhouse.value === 'yes') {
                sizeDiv.classList.remove('hidden');
            } else {
                sizeDiv.classList.add('hidden');
            }
        }

        function toggleProcessingDetails() {
            const valueAddition = document.querySelector('input[name="value_addition"]:checked');
            const details = document.getElementById('processing-details');
            
            if (valueAddition && valueAddition.value === 'yes') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleSoilTestUpload() {
            const soilTest = document.querySelector('input[name="soil_test_recent"]:checked');
            const upload = document.getElementById('soil-test-upload');
            
            if (soilTest && soilTest.value === 'yes') {
                upload.classList.remove('hidden');
            } else {
                upload.classList.add('hidden');
            }
        }

        function toggleIrrigationSource() {
            const irrigationType = document.getElementById('irrigation_type').value;
            const sourceDiv = document.getElementById('irrigation-source-div');
            
            if (irrigationType && irrigationType !== 'none') {
                sourceDiv.classList.remove('hidden');
            } else {
                sourceDiv.classList.add('hidden');
            }
        }

        function toggleAlertChannels() {
            const wantsAlerts = document.querySelector('input[name="weather_alerts"]:checked');
            const channels = document.getElementById('alert-channels');
            
            if (wantsAlerts && wantsAlerts.value === 'yes') {
                channels.classList.remove('hidden');
            } else {
                channels.classList.add('hidden');
            }
        }

        function toggleSoftwareName() {
            const usesSoftware = document.querySelector('input[name="farm_software_usage"]:checked');
            const nameDiv = document.getElementById('software-name');
            
            if (usesSoftware && usesSoftware.value === 'yes') {
                nameDiv.classList.remove('hidden');
            } else {
                nameDiv.classList.add('hidden');
            }
        }

        function toggleSalesChannels() {
            const sellsProduce = document.querySelector('input[name="sells_produce"]:checked');
            const channels = document.getElementById('sales-channels');
            
            if (sellsProduce && sellsProduce.value === 'yes') {
                channels.classList.remove('hidden');
            } else {
                channels.classList.add('hidden');
            }
        }

        function toggleExportDetails() {
            const exportActivities = document.querySelector('input[name="export_activities"]:checked');
            const details = document.getElementById('export-details');
            
            if (exportActivities && (exportActivities.value === 'yes' || exportActivities.value === 'interested')) {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleLoanDetails() {
            const currentLoan = document.querySelector('input[name="current_loan"]:checked');
            const details = document.getElementById('loan-details');
            
            if (currentLoan && currentLoan.value === 'yes') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleStaffCount() {
            const hasStaff = document.querySelector('input[name="has_staff"]:checked');
            const countDiv = document.getElementById('staff-count');
            
            if (hasStaff && hasStaff.value === 'yes') {
                countDiv.classList.remove('hidden');
            } else {
                countDiv.classList.add('hidden');
            }
        }

        function toggleTrainingTopics() {
            const trainingInterest = document.querySelector('input[name="training_interest"]:checked');
            const topicsDiv = document.getElementById('training-topics');
            
            if (trainingInterest && trainingInterest.value === 'yes') {
                topicsDiv.classList.remove('hidden');
            } else {
                topicsDiv.classList.add('hidden');
            }
        }

        function toggleVoiceLanguage() {
            const voiceNotifications = document.querySelector('input[name="voice_notifications"]:checked');
            const languageDiv = document.getElementById('voice-language');
            
            if (voiceNotifications && voiceNotifications.value === 'yes') {
                languageDiv.classList.remove('hidden');
            } else {
                languageDiv.classList.add('hidden');
            }
        }

        function toggleIdUpload() {
            const idType = document.getElementById('government_id_type').value;
            const uploadDiv = document.getElementById('id-upload');
            
            if (idType) {
                uploadDiv.classList.remove('hidden');
            } else {
                uploadDiv.classList.add('hidden');
            }
        }

        function toggleScalingDetails() {
            const scalingPlans = document.querySelector('input[name="scaling_plans"]:checked');
            const details = document.getElementById('scaling-details');
            
            if (scalingPlans && scalingPlans.value === 'yes') {
                details.classList.remove('hidden');
            } else {
                details.classList.add('hidden');
            }
        }

        function toggleCallTimes() {
            const onboardingCall = document.querySelector('input[name="onboarding_call"]:checked');
            const timesDiv = document.getElementById('call-times');
            
            if (onboardingCall && onboardingCall.value === 'yes') {
                timesDiv.classList.remove('hidden');
            } else {
                timesDiv.classList.add('hidden');
            }
        }

        function toggleReferralOther() {
            const referralSource = document.getElementById('referral_source').value;
            const otherDiv = document.getElementById('referral-other');
            
            if (referralSource === 'other') {
                otherDiv.classList.remove('hidden');
            } else {
                otherDiv.classList.add('hidden');
            }
        }

        function toggleCooperativeName() {
            const cooperativeMember = document.querySelector('input[name="cooperative_member"]:checked');
            const nameDiv = document.getElementById('cooperative-name');
            
            if (cooperativeMember && cooperativeMember.value === 'yes') {
                nameDiv.classList.remove('hidden');
            } else {
                nameDiv.classList.add('hidden');
            }
        }

        function toggleDataUpload() {
            const dataImport = document.querySelector('input[name="data_import"]:checked');
            const uploadDiv = document.getElementById('data-upload');
            
            if (dataImport && dataImport.value === 'yes') {
                uploadDiv.classList.remove('hidden');
            } else {
                uploadDiv.classList.add('hidden');
            }
        }

        // Step navigation
        function nextStep() {
            if (validateStep(currentStep)) {
                saveStepData(currentStep);
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Hide all steps
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (stepElement) {
                    stepElement.classList.add('hidden');
                }
                
                const indicator = document.getElementById(`step-indicator-${i}`);
                if (indicator) {
                    indicator.classList.remove('active', 'completed');
                    indicator.classList.add('bg-white/20', 'text-white/60');
                    
                    if (i < currentStep) {
                        indicator.classList.remove('bg-white/20', 'text-white/60');
                        indicator.classList.add('completed');
                    } else if (i === currentStep) {
                        indicator.classList.remove('bg-white/20', 'text-white/60');
                        indicator.classList.add('active');
                    }
                }
            }
            
            // Show current step
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            if (currentStepElement) {
                currentStepElement.classList.remove('hidden');
            }
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');
            
            if (currentStep === 1) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }
            
            if (currentStep === totalSteps) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
            
            // Update step text
            const stepTexts = [
                'Step 1 of 5: Account & Location',
                'Step 2 of 5: Farm Type & Production',
                'Step 3 of 5: Climate & Preferences',
                'Step 4 of 5: Technology & Market',
                'Step 5 of 5: Goals & Verification'
            ];
            
            const stepTextElement = document.getElementById('current-step-text');
            if (stepTextElement) {
                stepTextElement.textContent = stepTexts[currentStep - 1];
            }
            
            // Update progress bars
            for (let i = 1; i < totalSteps; i++) {
                const progressBar = document.getElementById(`progress-bar-${i}`);
                if (progressBar) {
                    if (i < currentStep) {
                        progressBar.style.width = '100%';
                    } else if (i === currentStep) {
                        progressBar.style.width = '50%';
                    } else {
                        progressBar.style.width = '0%';
                    }
                }
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateStep(step) {
            const stepElement = document.getElementById(`step-${step}`);
            if (!stepElement) return true;
            
            const requiredFields = stepElement.querySelectorAll('[required]');
            let isValid = true;
            let firstInvalidField = null;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-red-500', 'bg-red-50', 'dark:bg-red-900/20');
                    isValid = false;
                    
                    if (!firstInvalidField) {
                        firstInvalidField = field;
                    }
                    
                    // Add shake animation
                    field.classList.add('animate-pulse');
                    setTimeout(() => field.classList.remove('animate-pulse'), 1000);
                } else {
                    field.classList.remove('border-red-500', 'bg-red-50', 'dark:bg-red-900/20');
                    field.classList.add('border-green-500');
                }
            });
            
            // Step-specific validations
            if (step === 1) {
                // Email validation
                if (!validateEmail()) {
                    isValid = false;
                }
                
                // Password validation
                if (!checkPasswordStrength()) {
                    showNotification('Password must be stronger', 'warning');
                    isValid = false;
                }
                
                // Password confirmation
                if (!checkPasswordMatch()) {
                    isValid = false;
                }
            }
            
            if (step === 2) {
                // Check if at least one farm type is selected
                const farmTypes = stepElement.querySelectorAll('input[name="farm_type"]:checked');
                if (farmTypes.length === 0) {
                    showNotification('Please select at least one farm type', 'error');
                    isValid = false;
                }
            }
            
            if (step === 5) {
                // Check required consents
                const alertConsent = stepElement.querySelector('input[name="alert_consent"]');
                const agreeTerms = stepElement.querySelector('input[name="agree_terms"]');
                const agreePrivacy = stepElement.querySelector('input[name="agree_privacy"]');
                
                if (!alertConsent.checked || !agreeTerms.checked || !agreePrivacy.checked) {
                    showNotification('Please accept the required terms and privacy policy', 'error');
                    isValid = false;
                }
            }
            
            if (!isValid) {
                showNotification('Please fill in all required fields correctly', 'error');
                
                // Scroll to first invalid field
                if (firstInvalidField) {
                    firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(() => firstInvalidField.focus(), 500);
                }
            }
            
            return isValid;
        }

        function saveStepData(step) {
            const stepElement = document.getElementById(`step-${step}`);
            const inputs = stepElement.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    if (input.checked) {
                        if (!formData[input.name]) {
                            formData[input.name] = [];
                        }
                        if (Array.isArray(formData[input.name])) {
                            if (!formData[input.name].includes(input.value)) {
                                formData[input.name].push(input.value);
                            }
                        } else {
                            formData[input.name] = [formData[input.name], input.value];
                        }
                    }
                } else if (input.type === 'radio') {
                    if (input.checked) {
                        formData[input.name] = input.value;
                    }
                } else if (input.type === 'file') {
                    if (input.files.length > 0) {
                        if (input.multiple) {
                            formData[input.name] = Array.from(input.files);
                        } else {
                            formData[input.name] = input.files[0];
                        }
                    }
                } else {
                    formData[input.name] = input.value;
                }
            });
        }

        // Form submission
        async function handleFormSubmission(event) {
            event.preventDefault();
            
            if (!validateStep(currentStep)) {
                return;
            }
            
            // Show loading overlay
            showLoadingOverlay();
            
            try {
                // Save final step data
                saveStepData(currentStep);
                
                // Collect complete form data
                const completeFormData = collectCompleteFormData();
                
                // Upload files first
                updateLoadingProgress(20, 'Uploading files...');
                const fileUploads = await uploadFiles(completeFormData);
                
                // Create user account with Supabase Auth
                updateLoadingProgress(40, 'Creating your account...');
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: completeFormData.email,
                    password: completeFormData.password,
                    options: {
                        data: {
                            full_name: completeFormData.full_name,
                            display_name: completeFormData.display_name || completeFormData.full_name
                        },
                        emailRedirectTo: `${window.location.origin}/email-verified.html`
                    }
                });

                if (authError) throw authError;

                // Insert user profile data
                updateLoadingProgress(60, 'Setting up your farm profile...');
                const profileData = {
                    id: authData.user.id,
                    ...completeFormData,
                    ...fileUploads,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                const { error: profileError } = await supabase
                    .from('user_profiles')
                    .insert([profileData]);

                if (profileError) throw profileError;

                // Generate initial recommendations
                updateLoadingProgress(80, 'Generating personalized recommendations...');
                await generateInitialRecommendations(authData.user.id, completeFormData);
                
                // Set up weather alerts
                updateLoadingProgress(90, 'Setting up weather monitoring...');
                await setupWeatherAlerts(authData.user.id, completeFormData);
                
                // Send welcome notifications
                updateLoadingProgress(95, 'Finalizing setup...');
                await sendWelcomeNotifications(completeFormData);

                updateLoadingProgress(100, 'Complete! Redirecting to your dashboard...');

                // Success - redirect to dashboard
                showNotification('Welcome to Agriclimate Connect! Please check your email to verify your account.', 'success');
                
                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 3000);

            } catch (error) {
                console.error('Registration error:', error);
                hideLoadingOverlay();
                showNotification('Registration failed: ' + error.message, 'error');
            }
        }

        function collectCompleteFormData() {
            // Merge all saved form data
            const allFormData = { ...formData };
            
            // Process checkbox arrays
            const checkboxGroups = [
                'farm_type', 'primary_crops', 'secondary_crops', 'livestock_types',
                'alert_channels', 'recommendation_crops', 'fertilizer_types',
                'livestock_breeds', 'feed_sources', 'farm_machinery', 'iot_sensors',
                'sales_channels', 'sell_commodities', 'accessibility_needs',
                'forum_topics', 'farming_goals', 'biggest_challenges', 'training_topics',
                'preferred_languages', 'preferred_call_times'
            ];
            
            checkboxGroups.forEach(group => {
                if (!allFormData[group]) allFormData[group] = [];
            });
            
            // Convert numeric fields
            const numericFields = [
                'farm_size', 'elevation', 'water_source_distance', 'greenhouse_size_value',
                'production_volume', 'soil_ph', 'organic_matter', 'planting_density',
                'average_price', 'farming_experience', 'staff_count', 'income_growth_target',
                'household_size', 'herd_size'
            ];
            
            numericFields.forEach(field => {
                if (allFormData[field] && allFormData[field] !== '') {
                    allFormData[field] = parseFloat(allFormData[field]);
                }
            });
            
            // Handle boolean conversions
            const booleanFields = [
                'marketing_emails', 'alert_consent', 'research_consent', 'location_sharing',
                'agree_terms', 'agree_privacy'
            ];
            
            booleanFields.forEach(field => {
                if (allFormData[field] !== undefined) {
                    allFormData[field] = allFormData[field] === 'yes' || allFormData[field] === true;
                }
            });
            
            return allFormData;
        }

        // File upload functions
        async function uploadFiles(formData) {
            const fileUploads = {};
            
            try {
                // Profile photo upload
                if (formData.profile_photo && formData.profile_photo instanceof File) {
                    const photoPath = `profile-photos/${formData.email}/${Date.now()}-${formData.profile_photo.name}`;
                    const { data: photoData, error: photoError } = await supabase.storage
                        .from('user-files')
                        .upload(photoPath, formData.profile_photo);
                    
                    if (!photoError) {
                        const { data: { publicUrl } } = supabase.storage
                            .from('user-files')
                            .getPublicUrl(photoPath);
                        fileUploads.profile_photo_url = publicUrl;
                    }
                }
                
                // Soil test file upload
                if (formData.soil_test_file && formData.soil_test_file instanceof File) {
                    const soilPath = `soil-tests/${formData.email}/${Date.now()}-${formData.soil_test_file.name}`;
                    const { data: soilData, error: soilError } = await supabase.storage
                        .from('user-files')
                        .upload(soilPath, formData.soil_test_file);
                    
                    if (!soilError) {
                        fileUploads.soil_test_file_url = soilPath;
                    }
                }
                
                // Vaccination file upload
                if (formData.vaccination_file && formData.vaccination_file instanceof File) {
                    const vaccPath = `vaccination/${formData.email}/${Date.now()}-${formData.vaccination_file.name}`;
                    const { data: vaccData, error: vaccError } = await supabase.storage
                        .from('user-files')
                        .upload(vaccPath, formData.vaccination_file);
                    
                    if (!vaccError) {
                        fileUploads.vaccination_file_url = vaccPath;
                    }
                }
                
                // Certificates upload
                if (formData.certificates_file && formData.certificates_file instanceof FileList) {
                    const certificatePaths = [];
                    for (let file of formData.certificates_file) {
                        const certPath = `certificates/${formData.email}/${Date.now()}-${file.name}`;
                        const { data: certData, error: certError } = await supabase.storage
                            .from('user-files')
                            .upload(certPath, file);
                        
                        if (!certError) {
                            certificatePaths.push(certPath);
                        }
                    }
                    if (certificatePaths.length > 0) {
                        fileUploads.certificates_file_urls = certificatePaths;
                    }
                }
                
                // Government ID upload
                if (formData.government_id_file && formData.government_id_file instanceof File) {
                    const idPath = `government-ids/${formData.email}/${Date.now()}-${formData.government_id_file.name}`;
                    const { data: idData, error: idError } = await supabase.storage
                        .from('user-files')
                        .upload(idPath, formData.government_id_file);
                    
                    if (!idError) {
                        fileUploads.government_id_file_url = idPath;
                    }
                }
                
                // Data import file upload
                if (formData.data_import_file && formData.data_import_file instanceof File) {
                    const dataPath = `data-imports/${formData.email}/${Date.now()}-${formData.data_import_file.name}`;
                    const { data: dataUploadResult, error: dataError } = await supabase.storage
                        .from('user-files')
                        .upload(dataPath, formData.data_import_file);
                    
                    if (!dataError) {
                        fileUploads.data_import_file_url = dataPath;
                    }
                }
                
            } catch (error) {
                console.error('File upload error:', error);
            }
            
            return fileUploads;
        }

        // Loading overlay functions
        function showLoadingOverlay() {
            document.getElementById('loading-overlay').classList.remove('hidden');
            updateLoadingProgress(0, 'Initializing...');
        }

        function hideLoadingOverlay() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        function updateLoadingProgress(percentage, message) {
            const progressBar = document.getElementById('loading-progress');
            const loadingText = document.getElementById('loading-text');
            
            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (loadingText) loadingText.textContent = message;
        }

        // Generate initial recommendations
        async function generateInitialRecommendations(userId, userData) {
            try {
                const recommendations = {
                    crops: ['drought-resistant-maize', 'climate-smart-beans', 'heat-tolerant-tomatoes'],
                    livestock: ['zebu-cattle', 'dorper-sheep', 'kalahari-goats'],
                    practices: ['water-efficient-irrigation', 'organic-fertilization', 'pest-integrated-management']
                };
                
                await supabase.from('user_recommendations').insert([{
                    user_id: userId,
                    type: 'initial',
                    recommendations: recommendations,
                    created_at: new Date().toISOString()
                }]);
            } catch (error) {
                console.error('Error generating recommendations:', error);
            }
        }

        // Setup weather alerts
        async function setupWeatherAlerts(userId, userData) {
            if (userData.weather_alerts === 'yes') {
                try {
                    const alertData = {
                        user_id: userId,
                        latitude: userData.latitude,
                        longitude: userData.longitude,
                        alert_channels: userData.alert_channels || ['email'],
                        severity_preference: userData.alert_frequency || 'medium',
                        created_at: new Date().toISOString()
                    };
                    
                    await supabase.from('weather_alert_settings').insert([alertData]);
                } catch (error) {
                    console.error('Error setting up weather alerts:', error);
                }
            }
        }

        // Send welcome notifications
        async function sendWelcomeNotifications(userData) {
            console.log('Sending welcome notifications to:', userData.email, userData.phone_number);
        }

        // Notification system
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            
            const icons = {
                success: 'fa-check-circle text-green-500',
                error: 'fa-times-circle text-red-500',
                warning: 'fa-exclamation-triangle text-yellow-500',
                info: 'fa-info-circle text-blue-500'
            };
            
            const colors = {
                success: 'bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200',
                error: 'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200',
                warning: 'bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200',
                info: 'bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 text-blue-800 dark:text-blue-200'
            };
            
            notification.className = `p-4 rounded-xl border ${colors[type]} max-w-sm shadow-lg backdrop-blur-sm animate-slide-up`;
            notification.innerHTML = `
                <div class="flex items-start">
                    <i class="fas ${icons[type]} mt-0.5 mr-3 text-lg"></i>
                    <div class="flex-1">
                        <p class="font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);
        }

        // Add form submission event listener
        document.getElementById('registration-form').addEventListener('submit', handleFormSubmission);
    </script>
</body>
</html>